# Backend (Node.js/Express)

This is the backend for the Survey Application, built with Node.js, Express, TypeScript, and Prisma ORM.

## Features
- User registration and login with JWT authentication
- Survey questions and options from PostgreSQL
- Response submission and validation
- Prisma ORM for database access

## Getting Started

### Prerequisites
- Node.js (v16+ recommended)
- npm or yarn
- PostgreSQL

### Setup
1. Install dependencies:
   ```bash
   npm install
   ```
2. Copy `.env.example` to `.env` and update the values as needed (see below).
3. Run Prisma migrations:
   ```bash
   npx prisma migrate dev --name init
   ```
4. Start the backend server:
   ```bash
   npm run dev
   ```

## Folder Structure
```
server/
├── src/
│   ├── controllers/
│   ├── services/
│   ├── middleware/
│   └── ...
└── ...
```

## Customization
- Edit survey logic in `src/services/surveyService.ts`.
- Adjust authentication in `src/services/authService.ts`.

## Components and Files Overview

### `src/controllers/`
- **authController.ts**: Handles authentication endpoints (register, login). Calls service functions and returns responses to the client.
- **surveyController.ts**: Handles survey-related endpoints (fetch questions, submit responses). Calls service functions and returns responses to the client.

### `src/services/`
- **authService.ts**: Business logic for authentication. Handles user registration, password hashing, login, and JWT generation.
- **surveyService.ts**: Business logic for survey features. Fetches questions (with options) and saves user responses to the database.

### `src/middleware/`
- **auth.ts**: Express middleware for JWT authentication. Protects routes by verifying tokens and attaching user info to requests.

### `prisma/`
- **schema.prisma**: Prisma schema defining database models (User, Question, Option, Response, etc.).
- **migrations/**: Database migration files generated by Prisma.

### Root Files
- **server.ts**: Entry point for the Express server. Sets up middleware, routes, and starts the server.
- **package.json**: Lists backend dependencies and scripts.
- **tsconfig.json**: TypeScript configuration.
- **.env.example**: Example environment variables (never commit real `.env`).
- **README.md**: Project documentation (this file).
- **.gitignore**: Specifies files/folders to exclude from git.

---

Each file is modular and focused on a single responsibility, making the backend easy to maintain and extend.

## License
MIT


## Environment Variables (.env)

You must create a `.env` file in the `server` directory. Use `.env.example` as a template. **Never commit your real `.env` to git.**

**Variables to set in `.env`:**

- `PORT`: The port your backend server will run on (default: 5000).
- `JWT_KEY`: A strong, random secret key for signing JWT tokens. **Change this to your own secure value!**
- `DATABASE_URL`: Your PostgreSQL connection string. Update with your actual database username, password, host, port, and database name.

**Example:**

```
PORT=5000
JWT_KEY=your_jwt_secret_key_here
DATABASE_URL=postgresql://user:password@localhost:5432/surveydb
```

**What to change:**
- Set `JWT_KEY` to a long, random string (never use the default in production).
- Update `DATABASE_URL` with your real PostgreSQL credentials and database name.
- You can change `PORT` if you want the server to run on a different port.

**Never upload your real `.env` to git or share it publicly. Only share `.env.example`.**
### Running the Backend Server

After setting up your `.env` file and installing dependencies, use the following commands:


1. **Install dependencies:**
   ```bash
   npm install
   ```

2. **Generate the Prisma client:**
   ```bash
   npx prisma generate
   ```
   This step is required after every `npm install` or when you clone/pull the repo.

3. **Run database migrations (Prisma):**
   ```bash
   npx prisma migrate dev --name init
   ```
   If you see an error about `DATABASE_URL`, make sure your `.env` file exists and is filled out correctly.

4. **Build the TypeScript code:**
   ```bash
   npm run build
   ```
   This will create the `dist/` folder with compiled JavaScript files.

5. **Start the server:**
   ```bash
   npm start
   ```
   If you see an error like `Cannot find module 'dist/server.js'`, it means you need to run `npm run build` first.
   If you see an error about `@prisma/client did not initialize yet`, run `npx prisma generate` again.

6. **For development (auto-reloads with ts-node):**
   ```bash
   npm run dev
   ```

**Note:**
- Never upload your `dist/` folder to GitHub. Always build it fresh after cloning or pulling the repo.
- Always run `npm install` and `npm run build` after cloning or pulling.
